<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>AWei’s Kernel Tour | 【模板与泛型编程01】函数模板</title>
    <meta name="description"
        content="一、定义函数模板 1、基本范例 1 2 3 4 5 6 7 template &lt;typename T&gt; int compare(const T &amp;v1 , const T &amp;v2) { if(v1 &lt; v2) return -1; if(v2 &lt; v1) return 1; return 0; } 模板定义以关键字 template开始，后接模板形参表，模板形参表是用尖括号&lt;&gt;括住的一个或多个模板形参的列表，用逗号分隔，不能为空。 ">
    <link rel="canonical" href="https://cnjslw.github.io/posts/%E5%87%BD%E6%95%B0%E6%A8%A1%E6%9D%BF/" />
    <link rel="icon" type="image/x-icon" href="/images/linux_pic.ico">
    <meta property="og:title" content="【模板与泛型编程01】函数模板" />
<meta property="og:description" content="一、定义函数模板 1、基本范例 1 2 3 4 5 6 7 template &lt;typename T&gt; int compare(const T &amp;v1 , const T &amp;v2) { if(v1 &lt; v2) return -1; if(v2 &lt; v1) return 1; return 0; } 模板定义以关键字 template开始，后接模板形参表，模板形参表是用尖括号&lt;&gt;括住的一个或多个模板形参的列表，用逗号分隔，不能为空。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cnjslw.github.io/posts/%E5%87%BD%E6%95%B0%E6%A8%A1%E6%9D%BF/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-08T15:45:34+08:00" />
<meta property="article:modified_time" content="2022-06-08T15:45:34+08:00" />


    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="【模板与泛型编程01】函数模板"/>
<meta name="twitter:description" content="一、定义函数模板 1、基本范例 1 2 3 4 5 6 7 template &lt;typename T&gt; int compare(const T &amp;v1 , const T &amp;v2) { if(v1 &lt; v2) return -1; if(v2 &lt; v1) return 1; return 0; } 模板定义以关键字 template开始，后接模板形参表，模板形参表是用尖括号&lt;&gt;括住的一个或多个模板形参的列表，用逗号分隔，不能为空。"/>

    
    
    

    <link rel="stylesheet" href='/css/style.css' />
    <link rel="stylesheet" href='/css/search.css' />
    <link rel="stylesheet" href='/css/md_nb.css' />
    <link rel="stylesheet" href='/css/list.css' />
    <link rel="stylesheet" href='/css/terms.css' />
    <link rel="stylesheet" href='/css/taxonomy.css' />
    <link rel="stylesheet" href='/css/font-awesome-4.7.0/css/font-awesome.min.css' />
    <link rel="stylesheet" href='/css/home.css' />
    <link rel="stylesheet" href='/css/syntax.css' />
    
    <link rel="stylesheet" href='/css/shortcode.css' />

    
    <link rel="stylesheet" href='/css/_custom.css' />
    <style>
        {
                {
                if eq .Kind "404"
            }
        }

        body::after {
            display: none;
        }

            {
                {
                end
            }
        }
    </style>
    
    
    
    
    <script src="/js/lazysizes.min.js" async=""></script>
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="/js/search.js"></script>
    <script src="/js/md_nb.js"></script>
    <script src="/js/yes.js"></script>
    
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
</head><body style="font-family: ,'Helvetica Neue', Helvetica, Arial, 'PingFang SC', 'Hiragino Sans GB', 'Heiti SC', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;">
        <div class="loading">
            <div class="loading-bg"></div>
            <div class="loading-long">
                <div class="loading-short"></div>
            </div>
        </div>

        <header>
    <nav class="navbar">
        <div class="navbar-brand">
            <a href="/">
                <span class="logo">AWei’s Kernel Tour</span>
            </a>
        </div>
        <div class="navbar-menu">
            
                <a href="/">
                    <div class="menu-item">
                        <div class="hengtiao-root">
                            <div class="hengtiao"></div>
                            <div class="name text-wbd-reverse"><i class='fa fa-home'></i> 主页</div>
                        </div>
                    </div>
                </a>
            
                <a href="/posts">
                    <div class="menu-item">
                        <div class="hengtiao-root">
                            <div class="hengtiao"></div>
                            <div class="name text-wbd-reverse"><i class='fa fa-book'></i> 文章</div>
                        </div>
                    </div>
                </a>
            
                <a href="/categories">
                    <div class="menu-item">
                        <div class="hengtiao-root">
                            <div class="hengtiao"></div>
                            <div class="name text-wbd-reverse"><i class='fa fa-folder-open'></i> 分类</div>
                        </div>
                    </div>
                </a>
            
                <a href="/series">
                    <div class="menu-item">
                        <div class="hengtiao-root">
                            <div class="hengtiao"></div>
                            <div class="name text-wbd-reverse"><i class='fa fa-gears'></i> 系列</div>
                        </div>
                    </div>
                </a>
            
                <a href="/tags">
                    <div class="menu-item">
                        <div class="hengtiao-root">
                            <div class="hengtiao"></div>
                            <div class="name text-wbd-reverse"><i class='fa fa-tags'></i> 标签</div>
                        </div>
                    </div>
                </a>
            
                <a href="/about">
                    <div class="menu-item">
                        <div class="hengtiao-root">
                            <div class="hengtiao"></div>
                            <div class="name text-wbd-reverse"><i class='fa fa-info-circle'></i> 简历</div>
                        </div>
                    </div>
                </a>
            
            <div class="navbar-burger">
                <div class="burger-btn"><span><i class="fa fa-navicon"></i></span></div>
            </div>
            
            
            <div class="search-in"><span><i class="fa fa-search"></i></span></div>
            
                <div class="mode">
                    <span class="sun"><i class="fa fa-sun-o"></i></span>
                    <span class="moon"><i class="fa fa-moon-o"></i></span>
                </div>
            
        </div>
    </nav>
    <div class="burger-items">
        
        <a href="/">
            <div class="burger-item">
                <i class='fa fa-home'></i> 主页
            </div>
        </a>
        
        <a href="/posts">
            <div class="burger-item">
                <i class='fa fa-book'></i> 文章
            </div>
        </a>
        
        <a href="/categories">
            <div class="burger-item">
                <i class='fa fa-folder-open'></i> 分类
            </div>
        </a>
        
        <a href="/series">
            <div class="burger-item">
                <i class='fa fa-gears'></i> 系列
            </div>
        </a>
        
        <a href="/tags">
            <div class="burger-item">
                <i class='fa fa-tags'></i> 标签
            </div>
        </a>
        
        <a href="/about">
            <div class="burger-item">
                <i class='fa fa-info-circle'></i> 简历
            </div>
        </a>
        
    </div>
    <div class="header-rest"></div>
</header>


        <div id="content">








    <div class="hero">
        
            <div class="hero-img">
                <img class="lazyload" src="/images/thumbnail.gif" data-src="" alt="">
            </div>
        
        <div class="hero-content">
            <div class="hero-title">【模板与泛型编程01】函数模板</div>
            <div class="hero-subtitle"></div>
            <div class="hero-date">
                    <span class="no-wrap"><i class="fa fa-calendar"></i> 发布于: 2022-6-8 &nbsp;</span>
                    <span class="no-wrap"><i class="fa fa-calendar-check-o"></i> 更新于: 2022-6-8 &nbsp;</span>
                    <span class="no-wrap"><i class="fa fa-folder"></i>
                        未收录
                        
                    </span>    
            </div>
            <div class="timelong">
                <span class="no-wrap"><i class="fa fa-pencil"></i> 文章字数: 596 &nbsp;</span>
                <span class="no-wrap"><i class="fa fa-clock-o"></i> 阅读时间: 3 分钟 &nbsp;</span>
                <span class="no-wrap"><i class="fa fa-eye"></i> 阅读量: <span id="busuanzi_value_page_pv"></span></span>
            </div>
        </div>
    </div>




<div class="zhuti-0">
    <div class="container">
        <div class="zhuti">
            <div class="zhuti-l">
                




    


<div class="content-root">
    <div class="long">
        <button class="tosides-1 text-wbd">
            <i class="fa fa-arrow-right"></i>
        </button>
        <button class="tosides-2 text-wbd">
            <i class="fa fa-arrow-left"></i>
        </button>
        <button class="toup text-wbd">
            <i class="fa fa-arrow-up"></i>
        </button>
    </div>
    
        <div class="content">
            <div class="content-self">
                <h2 id="一定义函数模板">一、定义函数模板</h2>
<h3 id="1基本范例">1、基本范例</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">compare</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">v1</span> <span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">v2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">(</span><span class="n">v1</span> <span class="o">&lt;</span> <span class="n">v2</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">(</span><span class="n">v2</span> <span class="o">&lt;</span> <span class="n">v1</span><span class="p">)</span> <span class="k">return</span>  <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>模板定义以关键字 <code>template</code>开始，后接<strong>模板形参表</strong>，模板形参表是用<strong>尖括号</strong><code>&lt;&gt;</code>括住的一个或多个<strong>模板形参</strong>的列表，用逗号分隔，<strong>不能为空</strong>。</p>
<ul>
<li>模板程序应该尽量减少对实参类型的要求。</li>
<li>函数模板和类模板成员函数的定义通常放在头文件中([[C++ 模板的定义是否只能放在头文件中？]])。</li>
</ul>
<h3 id="2模板参数">2、模板参数</h3>
<h4 id="21-类型参数">2.1 类型参数</h4>
<p>类型参数前必须使用关键字<code>class</code>或者<code>typename</code>，这两个关键字含义相同，可以互换使用。旧的程序只能使用<code>class</code>。但是有些时候，<code>class</code>并不合适</p>
<h4 id="22-默认参数">2.2 默认参数</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span> <span class="p">,</span> <span class="k">typename</span> <span class="n">F</span> <span class="o">=</span> <span class="n">FunType</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">TestFunc</span><span class="p">(</span><span class="n">T</span> <span class="n">i</span> <span class="p">,</span> <span class="n">T</span> <span class="n">j</span> <span class="p">,</span> <span class="n">F</span> <span class="n">funcpoint</span><span class="o">=</span><span class="n">mf</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">funcpoint</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">TestFunc</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>调用testfunc()函数的时候，不用指定第3个实参，因为第3个参数有默认值。要注意默认参数的写法：针对当前的范例，类型模板参数F给了默认值，函数的形参也给了默认值。默认模板参数F是一个函数指针类型（FuncType），函数参数funcpoint = mf中的mf是函数名，代表函数首地址</p>
<p>另外，<strong>函数模板的默认模板参数可以放在前面</strong>（这一点类模板默认模板参数不一样，类模板的模板参数一旦有一个是默认参数，则其后续的参数都需要是默认参数）。</p>
<h4 id="23-非类型参数">2.3 非类型参数</h4>
<p>除了定义类型参数，还可以在模板中定义<strong>非类型参数(nontype parameter)</strong>
<strong>表示一个值而非一个类型</strong>。
当一个模板被实例化时，非类型参数被一个用户提供的或编译器推断出的值所代替。这些值必须是常量表达，从而允许编译器在编译时实例化模板。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="n">N</span> <span class="p">,</span> <span class="kt">unsigned</span> <span class="n">M</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">compare</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">p1</span><span class="p">)[</span><span class="n">N</span><span class="p">]</span> <span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">p2</span><span class="p">)[</span><span class="n">M</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nf">strcmp</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">compare</span><span class="p">(</span><span class="s">&#34;hi&#34;</span> <span class="p">,</span> <span class="s">&#34;mom&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//实例化模板
</span></span></span><span class="line"><span class="cl"><span class="c1">//int compare(const char (&amp;p1)[3] , const char (&amp;p2)[4])
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>一个非类型参数可以是一个整形，或者是一个指向对象或函数类型的指针或引用，绑定到非类型整数参数的实参必须是一个常量表达式。绑定到指针或引用非类型参数的实参，必须具有静态的生存期。</p>
<p>但是，并不是任何类型的参数都可以作为非类型模板参数，一般有以下一些是允许的
（1）整型或枚举类型。
（2）指针类型。
（3）左值引用类型。
（4）auto或decltype(auto)。对于decltype(auto)这个用法，其中的auto理解成要推导的类型，而decltype理解成推导过程采用decltype推导。
（5）可能还有其他类型，请读者自行在学习或阅读他人代码的过程中收集和总结。</p>
<h2 id="二-实例化函数模板">二、 实例化函数模板</h2>
<p>这里可以给实例化一个定义：用具体的“类型”代替“类型模板参数”的过程就叫作实例化（也称为代码生成器）。</p>
<h3 id="1一个错误的实例化示例">1、一个错误的实例化示例</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">T</span> <span class="n">sub</span><span class="p">(</span><span class="n">T</span> <span class="n">tv1</span> <span class="p">,</span> <span class="n">T</span> <span class="n">tv2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">tv1</span> <span class="o">-</span> <span class="n">tv2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span>    <span class="n">v1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span>    <span class="n">v2</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">sub</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">);</span><span class="c1">//return -1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">string</span> <span class="n">s1</span> <span class="o">=</span> <span class="s">&#34;Hello&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">string</span> <span class="n">s2</span> <span class="o">=</span> <span class="s">&#34;World&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">sub</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">);</span><span class="c1">//报错
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>所以，同样一个函数模板，可能以某种方式进行调用是合法的，而换一种方式调用就不合法了。尤其值得注意的是，这种合法性，在==编译阶段就可以由编译器判断出来==，因为这些对Sub()函数模板的调用代码就在这里摆着，编译器有能力在编译时就从这些调用代码中去推断Sub()函数模板中的模板参数T的类型。根据模板参数T的类型，编译器就能够判断出这个类型是否支持减法运算。</p>
<h3 id="2编译器视角的实例化">2、编译器视角的实例化</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">sub</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">sub</span><span class="p">(</span><span class="mf">1.1</span> <span class="p">,</span> <span class="mf">2.2</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">//.obj
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="n">sub</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="p">)</span> <span class="kt">double</span> <span class="kr">__cdecl</span> <span class="n">sub</span><span class="o">&lt;</span> <span class="kt">double</span> <span class="o">&gt;</span><span class="p">(</span> <span class="kt">double</span><span class="p">,</span> <span class="kt">double</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这说明在编译阶段，在对模板进行具体针对某类型的实例化之前，编译器需要查看函数模板的函数体，确定能否针对该类型进行实例化</p>
<p>当编译器遇到一个模板定义时，它并不生成代码。只有当我们实例化出模板的一个特定版本时，编译器才会生成代码</p>
<blockquote>
<p><strong>当编译器遇到类和普通函数</strong></p>
<ol>
<li>普通函数
当我们调用一个函数时，编译器只需要掌握函数的声明</li>
<li>类
当我们使用一个类类型的对象时，类定义必须是可用的，但成员函数的定义不必已经出现
我们将类定义和函数声明放在头文件中，而普通函数和类的成员函数的定义放在源文件中</li>
</ol>
</blockquote>
<p>为了生成个实例化版本，编译器需要掌握函数模板或类模板成员函数的定义。因此，与非模板代码不同，模板的头文件<strong>通常既包括声明也包括定义</strong>，所以函数模板与类模板成员函数的<strong>定义通常放在头文件中</strong>。</p>
<h3 id="3模板参数的实例化">3、模板参数的实例化</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="n">T</span> <span class="n">mydouble</span><span class="p">(</span><span class="n">T</span> <span class="n">tmpvalue</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">tmpvalue</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="31-显示实例化">3.1 显示实例化</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">mydouble</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">mydouble</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">17.7</span><span class="p">);</span><span class="c1">//warning C4244: “参数”: 从“double”转换到“T”，可能丢失数据
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="32-隐式实例化">3.2 隐式实例化</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">compare</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//实例化出一个特别版本的函数
</span></span></span><span class="line"><span class="cl"><span class="c1">//compare(const int&amp; , const int&amp;);
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>编译器用函数实参来为我们推断模板实参，实参类型是int。编译器会推断出模板实参为int , 并将它绑定到模板参数T。
编译器用推断出的模板参数来为我们<strong>实例化(instantiate)</strong> 一个特定版本的函数</p>
<p>隐式实例化下的空参数列表</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="n">mydouble</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="mf">16.9</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>&lt; &gt;</code>的作用：<code>&lt; &gt;</code>没什么用处，但是当有一个也叫作<code>mydouble()</code>的普通函数存在时，<code>&lt; &gt;</code>也许就会发挥作用</p>
<h4 id="33-部分实例化">3.3 部分实例化</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">V</span><span class="p">,</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span><span class="k">typename</span> <span class="n">U</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="n">V</span> <span class="n">Add</span><span class="p">(</span><span class="n">T</span> <span class="n">tv1</span><span class="p">,</span> <span class="n">U</span> <span class="n">tv2</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">tv1</span> <span class="o">+</span> <span class="n">tv2</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">Add</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mf">17.8</span><span class="p">);</span><span class="c1">//error C2672: “Add”&#34;: 找到匹配的重载函数 error C2783: “V Add(T,U)”: 未能为“V”推导模板参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Add</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">1.1</span> <span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// return 3.1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过尖括号指定一部分模板参数，另外一部分模板参数可以让编译器去推断。但是，一旦从某个模板参数开始推断，后续的所有模板参数都需要让编译器推断，==不可以自己指定第1个类型V和第3个类型U，然后推断中间第2个类型T，编译器不支持这种语法。==</p>
<h4 id="34-特化">3.4 特化</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">U</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">tfunc</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span> <span class="n">tmprv</span><span class="p">,</span> <span class="n">U</span><span class="o">&amp;</span> <span class="n">tmprv2</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">	<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;tfunc泛化版本&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">	<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">tmprv</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">	<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">tmprv2</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="341-全特化">3.4.1 全特化</h5>
<p>所谓全特化，就是把tfunc()这个泛化版本中的所有模板参数都用具体的类型代替，构成一个特殊的版本（全特化版本），既然所有模板参数都用具体的类型代替了，那么tfunc()泛化版本中template后面尖括号中的内容就变成空了。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">tfunc</span><span class="o">&lt;</span><span class="kt">int</span> <span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="kt">int</span><span class="o">&amp;</span> <span class="n">tmprv</span><span class="p">,</span> <span class="kt">double</span><span class="o">&amp;</span> <span class="n">tmprv2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;tfunc特化&#34;</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>全特化实际上等价于实例化一个函数模板，并不等价于一个函数重载</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">tfunc</span><span class="p">(</span><span class="kt">int</span><span class="o">&amp;</span> <span class="n">tmprv</span><span class="p">,</span> <span class="kt">double</span><span class="o">&amp;</span> <span class="n">tmprv2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;tfunc函数重载&#34;</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>==调用优先级：普通函数 &gt; 函数模板特化 &gt; 函数模板泛化==</strong></p>
<h5 id="342-偏特化">3.4.2 偏特化</h5>
<p>（1）模板参数数量上的偏特化
What is : 特化第1个模板参数类型为double类型，但第2个模板参数不特化</p>
<p>实际上，从模板参数数量上来讲，函数模板不能偏特化，只有类模板才能偏特化</p>
<p>（2）模板参数范围上的偏特化
What is : 所谓“参数范围”，比如原来是int类型，如果变成const int类型，那么与int类型相比，const int类型的范围就变小了；再比如，如果原来是任意类型T，现在变成T *（从任意类型缩小为任意指针类型），那这个类型的范围也是变小了；还有T &amp;（左值引用）、T&amp;&amp;（右值引用），对于T，从类型范围上都属于变小了。</p>
<p>对于函数模板，也不存在模板参数范围上的偏特化。因为这种所谓模板参数范围上的偏特化，实际上是函数模板的重载</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span> <span class="p">,</span> <span class="k">typename</span> <span class="n">U</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">tfunc</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">tmprv1</span><span class="p">,</span> <span class="n">U</span><span class="o">&amp;</span> <span class="n">tmprv2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;函数模板的参数范围偏特化本质上是函数模板的重载&#34;</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="35-实例化模板的返回值问题">3.5 实例化模板的返回值问题</h4>
<ul>
<li>显示实例化</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">Add</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">1.1</span> <span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>auto</li>
<li>使用auto结合decltype完成返回值类型推断</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">V</span><span class="p">,</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span><span class="k">typename</span> <span class="n">U</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">auto</span> <span class="n">Add</span><span class="p">(</span><span class="n">T</span> <span class="n">tv1</span><span class="p">,</span> <span class="n">U</span> <span class="n">tv2</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="c1">//auto Add(T tv1, U tv2) -&gt; decltype(tv1 + tv2)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{</span> 
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">tv1</span> <span class="o">+</span> <span class="n">tv2</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="三特异的语法">三、特异的语法</h2>
<h3 id="1省略参数">1、省略参数</h3>
<p>不管是类型模板参数还是非类型模板参数，如果在代码中没有用到这个参数，则参数名可以省略</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span> <span class="p">,</span><span class="kt">int</span> <span class="n">value</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">auto</span> <span class="n">Add2</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="k">return</span> <span class="mi">100</span><span class="p">;}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以做如下省略</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="p">,</span><span class="kt">int</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">auto</span> <span class="n">Add2</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="k">return</span> <span class="mi">100</span><span class="p">;}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2无用的typename">2、&ldquo;无用&quot;的typename</h3>
<p>类型前面可以增加一个typename修饰以明确标识一个类型。有的时候为了表明其后面是一个类型，也需要用typename修饰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span> <span class="p">,</span> <span class="k">typename</span> <span class="kt">int</span> <span class="n">value</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">auto</span> <span class="n">Add</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">100</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="四模板函数在工程中">四、模板函数在工程中</h2>
<h3 id="1inline和constexpr的含函数模板">1、inline和constexpr的含函数模板</h3>
<p>inline或 constexpr说明符放在模板参数列表之后，返回类型之前：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kr">inline</span> <span class="n">T</span> <span class="n">min</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="k">constexpr</span> <span class="n">T</span> <span class="n">min</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2编写与类型无关的代码">2、编写与类型无关的代码</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">int</span> <span class="n">compare</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">v1</span> <span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">v2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">(</span><span class="n">less</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">()(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">))</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">(</span><span class="n">less</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">()(</span><span class="n">v2</span><span class="p">,</span><span class="n">v1</span><span class="p">))</span> <span class="k">return</span>  <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span>                       <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这样写的好处</p>
<ol>
<li><code>const T &amp;</code>作为函数参数可以避免实参是不可调用类型</li>
<li><code>less&lt;T&gt;()</code>使用标准库可以避免有些类型没有定义<code>&gt;</code>的比较</li>
</ol>

            </div>
            
                <div class="tags">
                    
                </div>
            
        </div>
        
            
                <div class="pre-next">
                    
    
        
            <a href="https://cnjslw.github.io/posts/first-post/" class="next next-first" style="text-align: center;">
                <div class="next-title-root">
                    <span>First Post</span>
                </div>
                <span class="next-icon"><i class="fa fa-hand-o-right"></i></span>
            </a>
        
    

                </div>
            
        
    
</div>

    
        <div class="content-last">
            
                <button class="aixin content-last-item efct-button">
                    <i class="fa fa-heart"></i>
                </button>
            
            
        </div>
    


            </div>
            <div class="zhuti-r">
                
<div class="zhuti-r-0">
    <div class="zhuti-r-1">
        
        <div id="r1">
            

<div class="about-zuozhe">
    <div class="zuozhe">
        
            <div class="datou">
                <img class="lazyload" src="/images/thumbnail.gif" data-src="/images/author.png" alt="">
            </div>
        
        <div class="name-jianjie">
            <div class="name">AWei</div>
            <div class="jianjie">
                Be Water, My Friend.
            </div>
        </div>
    </div>

    <div class="type">
        <a href='
                    /posts/
                '>
            <p>文章</p>
            <p>2</p>
        </a>
        <a href='
                    /categories/
                '>
            <p>分类</p>
            <p>0</p>
        </a>
        <a href='
                    /tags/
                '>
            <p>标签</p>
            <p>0</p>
        </a>
    </div>

    <a href="https://github.com/cnjslw">
        <div class="follow">Follow Me</div>
    </a>
    <div class="link">
        
        <a href="https://github.com/cnjslw" class="link-item is-hidden-desktop" title="GitHub">
            <span class="icon"><i class='fa fa-github'></i></span>
        </a>
        
        <a href="https://www.youtube.com" class="link-item is-hidden-desktop" title="YouTube">
            <span class="icon"><i class='fa fa-youtube'></i></span>
        </a>
        
    </div>
</div>
            <div class="mulu">
    <div class="dong"></div>
    <div class="zhi">
        <div class="wenzi">
            <div class="zhi-mulu text-wbd">目录</div>
            <div class="mulu-items">
            </div>
        </div>
    </div>
</div>
            



    
    


<div class="other">
    <div class="other-up">
        <div class="other-qita text-wbd">相关文章</div>
        <div class="xian"></div>
    </div>
    <div class="list">
        
    </div>
</div>
        </div>
        <div id="r2">
            
        </div> 
    </div>
</div>

            </div>
        </div>
    </div>
</div>

    

<div class="sponsor">
    <div class="sponsor-self">
        <div class="sponsor-title">赞赏</div>
        <div class="sponsor-btn">
            
                
                    
                        <div class="sponsor-btn-1 border-r">Wechat</div>
                    
                
                
            
                
                    
                        <div class="sponsor-btn-2 border-l">Alipay</div>
                    
                
                
            
        </div>
        
        <div class="sponsor-img">
            
                
                    <img class="sponsor-img-1" src="/images/wechat.png" alt="">
                
                
            
                
                    <img class="sponsor-img-2" src="/images/alipay.png" alt="" style="display: none;">
                
                
            
        </div>
        <div class="cancel efct-button">取消</div>
    </div>
</div>


        </div>

        <footer class="footer">
    
        <div class="container">
            <div class="footer-items">
                
                    <div class="footer-item">
                        <i class="fa fa-user"></i> <span id="busuanzi_value_site_pv"></span> |
                        <i class="fa fa-eye"></i> <span id="busuanzi_value_site_uv"></span>
                    </div>
                
                
                    <div class="footer-item">
                        © 2022-2023 <a href="https://github.com/cnjslw">AWei</a>
                    </div>
                
                
                    <div class="footer-item">
                        Theme by <a href="https://github.com/xioyito/NewBee">NewBee</a> | Powered by <a href="https://gohugo.io/">Hugo</a>
                    </div>
                
            </div>
        </div>
    

    
</footer>


        
        <div class="search-root">
    <div class="search-zz"></div>
    <div class="search">
        <div class="sheader anniu">
            <div class="sh-l">
                <input type="text" placeholder='请输入关键词' id="search-key">
                <span class="sclear"><i class="fa fa-close"></i></span>
            </div>
            <div class="sh-r">
                <button>搜索</button>
            </div>
        </div>
        <div class="sbody">
            <div class="sbody-1">
                <div class="stip"></div>
            </div>
        </div>
    </div>
</div>
        









    
    

    
    


<script type="text/javascript">
    var mode_custom = "auto";
    var postsCount =  2 ;
    var arrPosts = [{"link":"https://cnjslw.github.io/posts/first-post/","plain":"","pubDate":"2023-06-08","title":"First Post"},{"link":"https://cnjslw.github.io/posts/%E5%87%BD%E6%95%B0%E6%A8%A1%E6%9D%BF/","plain":"一、定义函数模板 1、基本范例 1 2 3 4 5 6 7 template \u0026lt;typename T\u0026gt; int compare(const T \u0026amp;v1 , const T \u0026amp;v2) { if(v1 \u0026lt; v2) return -1; if(v2 \u0026lt; v1) return 1; return 0; } 模板定义以关键字 template开始，后接模板形参表，模板形参表是用尖括号\u0026lt;\u0026gt;括住的一个或多个模板形参的列表，用逗号分隔，不能为空。\n模板程序应该尽量减少对实参类型的要求。 函数模板和类模板成员函数的定义通常放在头文件中([[C++ 模板的定义是否只能放在头文件中？]])。 2、模板参数 2.1 类型参数 类型参数前必须使用关键字class或者typename，这两个关键字含义相同，可以互换使用。旧的程序只能使用class。但是有些时候，class并不合适\n2.2 默认参数 1 2 3 4 5 6 7 8 9 10 template\u0026lt;typename T , typename F = FunType\u0026gt; void TestFunc(T i , T j , F funcpoint=mf) { cout\u0026lt;\u0026lt;funcpoint(i,j)\u0026lt;\u0026lt;endl; } int main() { TestFunc(15,16); return 0; } 调用testfunc()函数的时候，不用指定第3个实参，因为第3个参数有默认值。要注意默认参数的写法：针对当前的范例，类型模板参数F给了默认值，函数的形参也给了默认值。默认模板参数F是一个函数指针类型（FuncType），函数参数funcpoint = mf中的mf是函数名，代表函数首地址\n另外，函数模板的默认模板参数可以放在前面（这一点类模板默认模板参数不一样，类模板的模板参数一旦有一个是默认参数，则其后续的参数都需要是默认参数）。\n2.3 非类型参数 除了定义类型参数，还可以在模板中定义非类型参数(nontype parameter) 表示一个值而非一个类型。 当一个模板被实例化时，非类型参数被一个用户提供的或编译器推断出的值所代替。这些值必须是常量表达，从而允许编译器在编译时实例化模板。\n1 2 3 4 5 6 7 8 9 template\u0026lt;unsigned N , unsigned M\u0026gt; int compare(const char (\u0026amp;p1)[N] , const char (\u0026amp;p2)[M]) { return strcmp(p1,p2); } compare(\u0026#34;hi\u0026#34; , \u0026#34;mom\u0026#34;); //实例化模板 //int compare(const char (\u0026amp;p1)[3] , const char (\u0026amp;p2)[4]) 一个非类型参数可以是一个整形，或者是一个指向对象或函数类型的指针或引用，绑定到非类型整数参数的实参必须是一个常量表达式。绑定到指针或引用非类型参数的实参，必须具有静态的生存期。\n但是，并不是任何类型的参数都可以作为非类型模板参数，一般有以下一些是允许的 （1）整型或枚举类型。 （2）指针类型。 （3）左值引用类型。 （4）auto或decltype(auto)。对于decltype(auto)这个用法，其中的auto理解成要推导的类型，而decltype理解成推导过程采用decltype推导。 （5）可能还有其他类型，请读者自行在学习或阅读他人代码的过程中收集和总结。\n二、 实例化函数模板 这里可以给实例化一个定义：用具体的“类型”代替“类型模板参数”的过程就叫作实例化（也称为代码生成器）。\n1、一个错误的实例化示例 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 template \u0026lt;typename T\u0026gt; T sub(T tv1 , T tv2) { return tv1 - tv2; } int main() { int v1 = 1; int v2 = 2; sub(v1,v2);//return -1 string s1 = \u0026#34;Hello\u0026#34;; string s2 = \u0026#34;World\u0026#34;; sub(s1,s2);//报错 return 0; } 所以，同样一个函数模板，可能以某种方式进行调用是合法的，而换一种方式调用就不合法了。尤其值得注意的是，这种合法性，在==编译阶段就可以由编译器判断出来==，因为这些对Sub()函数模板的调用代码就在这里摆着，编译器有能力在编译时就从这些调用代码中去推断Sub()函数模板中的模板参数T的类型。根据模板参数T的类型，编译器就能够判断出这个类型是否支持减法运算。\n2、编译器视角的实例化 1 2 sub(1,2); sub(1.1 , 2.2); 1 2 //.obj int __cdecl sub\u0026lt;int\u0026gt;(int,int) double __cdecl sub\u0026lt; double \u0026gt;( double, double) 这说明在编译阶段，在对模板进行具体针对某类型的实例化之前，编译器需要查看函数模板的函数体，确定能否针对该类型进行实例化\n当编译器遇到一个模板定义时，它并不生成代码。只有当我们实例化出模板的一个特定版本时，编译器才会生成代码\n当编译器遇到类和普通函数\n普通函数 当我们调用一个函数时，编译器只需要掌握函数的声明 类 当我们使用一个类类型的对象时，类定义必须是可用的，但成员函数的定义不必已经出现 我们将类定义和函数声明放在头文件中，而普通函数和类的成员函数的定义放在源文件中 为了生成个实例化版本，编译器需要掌握函数模板或类模板成员函数的定义。因此，与非模板代码不同，模板的头文件通常既包括声明也包括定义，所以函数模板与类模板成员函数的定义通常放在头文件中。\n3、模板参数的实例化 1 2 3 4 5 template\u0026lt;typename T\u0026gt; T mydouble(T tmpvalue) { return tmpvalue * 2; } 3.1 显示实例化 1 2 int result = mydouble\u0026lt;int\u0026gt;(16); int result = mydouble\u0026lt;int\u0026gt;(17.7);//warning C4244: “参数”: 从“double”转换到“T”，可能丢失数据 3.2 隐式实例化 1 2 3 cout \u0026lt;\u0026lt; compare(1,0) \u0026lt;\u0026lt; endl; //实例化出一个特别版本的函数 //compare(const int\u0026amp; , const int\u0026amp;); 编译器用函数实参来为我们推断模板实参，实参类型是int。编译器会推断出模板实参为int , 并将它绑定到模板参数T。 编译器用推断出的模板参数来为我们实例化(instantiate) 一个特定版本的函数\n隐式实例化下的空参数列表\n1 auto result = mydouble\u0026lt;\u0026gt;(16.9); \u0026lt; \u0026gt;的作用：\u0026lt; \u0026gt;没什么用处，但是当有一个也叫作mydouble()的普通函数存在时，\u0026lt; \u0026gt;也许就会发挥作用\n3.3 部分实例化 1 2 3 4 5 6 7 8 9 10 11 12 template \u0026lt;typename V,typename T,typename U\u0026gt; V Add(T tv1, U tv2) { return tv1 + tv2; } int main() { Add(15,17.8);//error C2672: “Add”\u0026#34;: 找到匹配的重载函数 error C2783: “V Add(T,U)”: 未能为“V”推导模板参数 Add\u0026lt;double\u0026gt;(1.1 , 2); // return 3.1 return 0; } 通过尖括号指定一部分模板参数，另外一部分模板参数可以让编译器去推断。但是，一旦从某个模板参数开始推断，后续的所有模板参数都需要让编译器推断，==不可以自己指定第1个类型V和第3个类型U，然后推断中间第2个类型T，编译器不支持这种语法。==\n3.4 特化 1 2 3 4 5 6 7 template \u0026lt;typename T, typename U\u0026gt; void tfunc(T\u0026amp; tmprv, U\u0026amp; tmprv2) { cout \u0026lt;\u0026lt; \u0026#34;tfunc泛化版本\u0026#34; \u0026lt;\u0026lt; endl; cout \u0026lt;\u0026lt; tmprv \u0026lt;\u0026lt; endl; cout \u0026lt;\u0026lt; tmprv2 \u0026lt;\u0026lt; endl; } 3.4.1 全特化 所谓全特化，就是把tfunc()这个泛化版本中的所有模板参数都用具体的类型代替，构成一个特殊的版本（全特化版本），既然所有模板参数都用具体的类型代替了，那么tfunc()泛化版本中template后面尖括号中的内容就变成空了。\n1 2 3 4 5 template\u0026lt;\u0026gt; void tfunc\u0026lt;int , double\u0026gt;(int\u0026amp; tmprv, double\u0026amp; tmprv2) { cout\u0026lt;\u0026lt;\u0026#34;tfunc特化\u0026#34;\u0026lt;\u0026lt;endl; } 全特化实际上等价于实例化一个函数模板，并不等价于一个函数重载\n1 2 3 4 void tfunc(int\u0026amp; tmprv, double\u0026amp; tmprv2) { cout\u0026lt;\u0026lt;\u0026#34;tfunc函数重载\u0026#34;\u0026lt;\u0026lt;endl; } ==调用优先级：普通函数 \u0026gt; 函数模板特化 \u0026gt; 函数模板泛化==\n3.4.2 偏特化 （1）模板参数数量上的偏特化 What is : 特化第1个模板参数类型为double类型，但第2个模板参数不特化\n实际上，从模板参数数量上来讲，函数模板不能偏特化，只有类模板才能偏特化\n（2）模板参数范围上的偏特化 What is : 所谓“参数范围”，比如原来是int类型，如果变成const int类型，那么与int类型相比，const int类型的范围就变小了；再比如，如果原来是任意类型T，现在变成T *（从任意类型缩小为任意指针类型），那这个类型的范围也是变小了；还有T \u0026amp;（左值引用）、T\u0026amp;\u0026amp;（右值引用），对于T，从类型范围上都属于变小了。\n对于函数模板，也不存在模板参数范围上的偏特化。因为这种所谓模板参数范围上的偏特化，实际上是函数模板的重载\n1 2 3 4 5 template \u0026lt;typename T , typename U\u0026gt; void tfunc(const T\u0026amp; tmprv1, U\u0026amp; tmprv2) { cout\u0026lt;\u0026lt;\u0026#34;函数模板的参数范围偏特化本质上是函数模板的重载\u0026#34;\u0026lt;\u0026lt;endl; } 3.5 实例化模板的返回值问题 显示实例化 1 Add\u0026lt;double\u0026gt;(1.1 , 3); auto 使用auto结合decltype完成返回值类型推断 1 2 3 4 5 6 template \u0026lt;typename V,typename T,typename U\u0026gt; auto Add(T tv1, U tv2) //auto Add(T tv1, U tv2) -\u0026gt; decltype(tv1 + tv2) { return tv1 + tv2; } 三、特异的语法 1、省略参数 不管是类型模板参数还是非类型模板参数，如果在代码中没有用到这个参数，则参数名可以省略\n1 2 3 template \u0026lt;typename T ,int value\u0026gt; auto Add2() {return 100;} 可以做如下省略\n1 2 3 template \u0026lt;typename ,int\u0026gt; auto Add2() {return 100;} 2、\u0026ldquo;无用\u0026quot;的typename 类型前面可以增加一个typename修饰以明确标识一个类型。有的时候为了表明其后面是一个类型，也需要用typename修饰\n1 2 3 4 5 template \u0026lt;typename T , typename int value\u0026gt; auto Add() { return 100; } 四、模板函数在工程中 1、inline和constexpr的含函数模板 inline或 constexpr说明符放在模板参数列表之后，返回类型之前：\n1 2 template \u0026lt;typename T\u0026gt; inline T min(const T\u0026amp;, const T\u0026amp;); template \u0026lt;typename T\u0026gt; constexpr T min(const T\u0026amp; , const T\u0026amp;); 2、编写与类型无关的代码 1 2 3 4 5 6 template \u0026lt;typename T\u0026gt; int compare(const T \u0026amp;v1 , const T \u0026amp;v2) { if(less\u0026lt;T\u0026gt;()(v1,v2)) return -1; if(less\u0026lt;T\u0026gt;()(v2,v1)) return 1; return 0; } 这样写的好处\nconst T \u0026amp;作为函数参数可以避免实参是不可调用类型 less\u0026lt;T\u0026gt;()使用标准库可以避免有些类型没有定义\u0026gt;的比较 ","pubDate":"2022-06-08","title":"【模板与泛型编程01】函数模板"}];
    var search_theEnd = "到底了";
    var search_nothing = "什么也没找到";
    var search_found = "找到";
    var search_result = "条结果";
    var search_results = "条结果";
    var enable_mermaid =  null 
</script>





        
    </body>
</html>

